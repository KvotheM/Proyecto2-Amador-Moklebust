#include <LiquidCrystal_I2C.h>
#include <Wire.h>

LiquidCrystal_I2C lcd(0x20, 16, 2);

typedef enum estado {E1, AM, PM, TY, seleccion};
estado actual = E1;
estado futuro = E1;
void panito();
void mensaje();
long temprano, noche, tem, noc;
const int8_t tylenol = 10;

char X;

const long intervalo = 1000;
unsigned long previousMillis = 0;
boolean ty;

void setup() {
  Serial.begin(9600);
  pinMode(tylenol, INPUT);
  pinMode(A0, INPUT);
  pinMode(A1, INPUT);
  lcd.init();
  lcd.backlight();
  lcd.print("Bienvenido");
  delay(1000);
  lcd.clear();
  }

void loop() {
  mensaje();
  tem = analogRead(A0);
  noc = analogRead(A1);
  temprano = map(tem, 0, 1023, 0, 110);
  noche = map(noc, 0, 1023, 0, 2);
  ty = digitalRead(tylenol);
  lcd.clear();
  lcd.print("Indique cuantas");
  lcd.setCursor(0, 1);
  lcd.print("pastillas");
  delay(1000);
  lcd.clear();
  
  switch (actual) {
    case E1:
      if (temprano >= 10 && temprano < 60  && ty == LOW) {
        futuro = AM;
        break;
      }
      else if (temprano > 60 && ty == LOW) {
        futuro = PM;
        break;
      } 
      else if (temprano < 10 && ty == HIGH) {
        futuro = TY;
        break;
      }
      else{
        futuro = seleccion;
        X = '0';
        break;
      }
    case AM:
      if (temprano >= 10 && temprano < 60  && ty == LOW) {
        futuro = seleccion;
        X = '1';
        break;
      }
    case PM:
      if (temprano > 60 && ty == LOW) {
        futuro = seleccion;
        X = '2';
        break;
      }
    case TY:
      if (temprano < 10 && ty == HIGH) {
        futuro = seleccion;
        X = '3';
        break;
      }
    case seleccion:
      futuro = E1;
      break;
  }
  switch (actual) {
    case seleccion:
      if(X == '1'){
        if(noc == 1){
          Serial.write(1);
          panito();
          break;
        }
        else if(noc == 2){
          Serial.write(2);
          panito();
          break;
        }
      }
      else if(X == '2'){
        if(noche == 1){
          Serial.write(3);
          panito();
          break;
        }
        else if(noche == 2){
          Serial.write(4);
          panito();
          break;
        }
      }
      else if(X == '3'){
        if(noche == 1){
          Serial.write(5);
          panito();
          break;
        }
        else if(noche == 2){
          Serial.write(6);
          panito();
          break;
        }
      }
      else{
        Serial.write(0);
        break;
      }
      break;
  }
  delay(1000);
  if (actual != futuro) {
    unsigned long currentMillis = millis();
    if (currentMillis - previousMillis >= intervalo) {
      actual = futuro;
      previousMillis = currentMillis;
    }
  }
}

void panito(){
  lcd.clear();
  lcd.print("Apague opcion");
  delay(5000);
  lcd.clear();
}
void mensaje(){
  lcd.print("Que pastilla");
  lcd.setCursor(0, 1);
  lcd.print("necesitas?");
  delay(1000);
  lcd.clear();
  lcd.print("Selecciona la");
  lcd.setCursor(0, 1);
  lcd.print("opcion");
  delay(1000);
}
